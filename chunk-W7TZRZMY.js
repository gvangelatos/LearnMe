import{d as u,e as E,g as P,i as A,j as f,k as R,l as m,oa as M,p as S,r as I}from"./chunk-6KAUTADS.js";import{a as o,b as n}from"./chunk-JHI3MBHO.js";var T=(()=>{let a=class a{constructor(){this.http=I(M),this.MAX_RETRIES=50}getAllData(){return this.http.get("https://docs.google.com/spreadsheets/d/1yRrrjbgYoQRKOnXMzhAFIZUgCnulSp8XYKZg3EuG4q0/export?format=csv",{responseType:"text"}).pipe(u(e=>this.csvToJson(e)))}csvToJson(e){let t=e.split(`
`),r=t[0].split(",");return t.slice(1).map(s=>{let l=s.split(",");return r.reduce((i,g,p)=>(i[g.trim()]=l[p]?.trim(),i),{})})}getMaxId(){let t="https://docs.google.com/spreadsheets/d/1yRrrjbgYoQRKOnXMzhAFIZUgCnulSp8XYKZg3EuG4q0/gviz/tq?tq="+encodeURIComponent(`
    SELECT A
    ORDER BY A DESC
    LIMIT 1
  `);return this.http.get(t,{responseType:"text"}).pipe(u(r=>JSON.parse(r.substring(47,r.length-2)).table.rows[0]?.c[0]?.v??null))}getRandomWords(e){return this.getMaxId().pipe(m(t=>this.getSpecificWordsData(this.getRandomNumbersInRange(0,t,6,e??[]))))}getRandomWordWithArticle(){return this.getMaxId().pipe(m(e=>E(()=>this.fetchRandomOnce(e)).pipe(R({count:this.MAX_RETRIES}),P(t=>t.length>0),f(1),A([]))))}fetchRandomOnce(e){let r=`
      SELECT A, B, C, D, E
      WHERE D IS NOT NULL
      LIMIT 1
      OFFSET ${Math.floor(Math.random()*e)}
    `;return this.makeRequest(r)}fetchMatchingWords(e){let r=`
      SELECT A, B, C, D, E
      WHERE lower(B) CONTAINS lower('${e.replace(/'/g,"\\'")}')
    `;return this.makeRequest(r)}makeRequest(e){let t="https://docs.google.com/spreadsheets/d/1yRrrjbgYoQRKOnXMzhAFIZUgCnulSp8XYKZg3EuG4q0/gviz/tq?tq="+encodeURIComponent(e);return this.http.get(t,{responseType:"text"}).pipe(u(r=>{let s=JSON.parse(r.substring(47,r.length-2)),l=s.table.cols.map(i=>i.label);return s.table.rows.map(i=>{let g={};return i.c.forEach((p,b)=>{g[l[b]]=p?.v??null}),g})}))}getRandomNumbersInRange(e=0,t,r=5,s){let l=new Set;for(;l.size<r;){let i=Math.floor(Math.random()*(t-e+1))+e;s.includes(i)||l.add(i)}return Array.from(l)}getSpecificWordsData(e){let t=`
    SELECT A, B, C, D, E
    WHERE A = ${e[0]} OR A = ${e[1]} OR A = ${e[2]} OR A = ${e[3]} OR A = ${e[4]} OR A = ${e[5]}
  `;return this.makeRequest(t)}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=S({token:a,factory:a.\u0275fac,providedIn:"root"});let h=a;return h})();var c=(function(h){return h.SwiperPage="swiperPageStatistics",h.SearchPage="searchPageStatistics",h.ArticlesPage="articlesPageStatistics",h})(c||{}),d={totalSuccesses:0,totalFails:0,byMonth:{}},y={totalSearches:0,totalEmptySearches:0,totalSuccessSearches:0,byMonth:{}};var Y=(()=>{let a=class a{setItem(e,t){let r=JSON.stringify(t);localStorage.setItem(e,r)}getItem(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error("Error reading from local storage",t),null}}removeItem(e){localStorage.removeItem(e)}addSwiperPageFailure(){let e=this.handleLocalStorageDataRetrieval(c.SwiperPage);this.applyPageFailure(c.SwiperPage,e)}addSearchPageSearch(e){let t=this.handleSearchPageLocalStorageDataRetrieval();e?this.applySearchPageIncrementEmpty(t):this.applySearchPageIncrement(t)}addArticlesPageSuccess(){let e=this.handleLocalStorageDataRetrieval(c.ArticlesPage);this.applyPageSuccess(c.ArticlesPage,e)}addArticlesPageFailure(){let e=this.handleLocalStorageDataRetrieval(c.ArticlesPage);this.applyPageFailure(c.ArticlesPage,e)}addSwiperPageSuccess(){let e=this.handleLocalStorageDataRetrieval(c.SwiperPage);this.applyPageSuccess(c.SwiperPage,e)}applySearchPageIncrement(e){let t=this.getYearMonth(),r=e.byMonth[t]??{searches:0,successSearches:0,emptySearches:0},s=n(o({},e),{totalSearches:e.totalSearches+1,totalSuccessSearches:e.totalSuccessSearches+1,byMonth:n(o({},e.byMonth),{[t]:n(o({},r),{searches:r.searches+1,successSearches:r.successSearches+1})})});this.setItem(c.SearchPage,s)}applySearchPageIncrementEmpty(e){let t=this.getYearMonth(),r=e.byMonth[t]??{searches:0,successSearches:0,emptySearches:0},s=n(o({},e),{totalSearches:e.totalSearches+1,totalEmptySearches:e.totalEmptySearches+1,byMonth:n(o({},e.byMonth),{[t]:n(o({},r),{searches:r.searches+1,emptySearches:r.emptySearches+1})})});this.setItem(c.SearchPage,s)}applyPageSuccess(e,t){let r=this.getYearMonth(),s=t.byMonth[r]??{successes:0,fails:0},l=n(o({},t),{totalSuccesses:t.totalSuccesses+1,byMonth:n(o({},t.byMonth),{[r]:n(o({},s),{successes:s.successes+1})})});this.setItem(e,l)}applyPageFailure(e,t){let r=this.getYearMonth(),s=t.byMonth[r]??{successes:0,fails:0},l=n(o({},t),{totalFails:t.totalFails+1,byMonth:n(o({},t.byMonth),{[r]:n(o({},s),{fails:s.fails+1})})});this.setItem(e,l)}getYearMonth(e=new Date){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0");return`${t}-${r}`}handleLocalStorageDataRetrieval(e){let t=this.getItem(e);return t||(this.setItem(e,d),t=d),t}handleSearchPageLocalStorageDataRetrieval(){let e=this.getItem(c.SearchPage);return e||(this.setItem(c.SearchPage,y),e=y),e}clear(){localStorage.clear()}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=S({token:a,factory:a.\u0275fac,providedIn:"root"});let h=a;return h})();export{T as a,Y as b};
