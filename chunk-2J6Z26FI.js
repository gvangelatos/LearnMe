import{md as O,od as J,q,t as z}from"./chunk-RTO6WDIM.js";import{e as ae,f as ue,g as _}from"./chunk-2R6CW7ES.js";var Q=ae((K,W)=>{"use strict";(function(k){"use strict";var a=ne(),F=re(),v=ie(),I=oe(),L={imagePlaceholder:void 0,cacheBust:!1},m={toSvg:H,toPng:X,toJpeg:R,toBlob:M,toPixelData:V,impl:{fontFaces:v,images:I,util:a,inliner:F,options:{}}};typeof W<"u"?W.exports=m:k.domtoimage=m;function H(n,t){return t=t||{},D(t),Promise.resolve(n).then(function(o){return G(o,t.filter,!0)}).then(Z).then(ee).then(r).then(function(o){return te(o,t.width||a.width(n),t.height||a.height(n))});function r(o){return t.bgcolor&&(o.style.backgroundColor=t.bgcolor),t.width&&(o.style.width=t.width+"px"),t.height&&(o.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(s){o.style[s]=t.style[s]}),o}}function V(n,t){return E(n,t||{}).then(function(r){return r.getContext("2d").getImageData(0,0,a.width(n),a.height(n)).data})}function X(n,t){return E(n,t||{}).then(function(r){return r.toDataURL()})}function R(n,t){return t=t||{},E(n,t).then(function(r){return r.toDataURL("image/jpeg",t.quality||1)})}function M(n,t){return E(n,t||{}).then(a.canvasToBlob)}function D(n){typeof n.imagePlaceholder>"u"?m.impl.options.imagePlaceholder=L.imagePlaceholder:m.impl.options.imagePlaceholder=n.imagePlaceholder,typeof n.cacheBust>"u"?m.impl.options.cacheBust=L.cacheBust:m.impl.options.cacheBust=n.cacheBust}function E(n,t){return H(n,t).then(a.makeImage).then(a.delay(100)).then(function(o){var s=r(n);return s.getContext("2d").drawImage(o,0,0),s});function r(o){var s=document.createElement("canvas");if(s.width=t.width||a.width(o),s.height=t.height||a.height(o),t.bgcolor){var l=s.getContext("2d");l.fillStyle=t.bgcolor,l.fillRect(0,0,s.width,s.height)}return s}}function G(n,t,r){if(!r&&t&&!t(n))return Promise.resolve();return Promise.resolve(n).then(o).then(function(i){return s(n,i,t)}).then(function(i){return l(n,i)});function o(i){return i instanceof HTMLCanvasElement?a.makeImage(i.toDataURL()):i.cloneNode(!1)}function s(i,u,y){var S=i.childNodes;if(S.length===0)return Promise.resolve(u);return g(u,a.asArray(S),y).then(function(){return u});function g(B,w,d){var P=Promise.resolve();return w.forEach(function(U){P=P.then(function(){return G(U,d)}).then(function(b){b&&B.appendChild(b)})}),P}}function l(i,u){if(!(u instanceof Element))return u;return Promise.resolve().then(y).then(S).then(g).then(B).then(function(){return u});function y(){w(window.getComputedStyle(i),u.style);function w(d,P){d.cssText?P.cssText=d.cssText:U(d,P);function U(b,x){a.asArray(b).forEach(function(e){x.setProperty(e,b.getPropertyValue(e),b.getPropertyPriority(e))})}}}function S(){[":before",":after"].forEach(function(d){w(d)});function w(d){var P=window.getComputedStyle(i,d),U=P.getPropertyValue("content");if(U===""||U==="none")return;var b=a.uid();u.className=u.className+" "+b;var x=document.createElement("style");x.appendChild(e(b,d,P)),u.appendChild(x);function e(c,h,f){var p="."+c+":"+h,A=f.cssText?N(f):$(f);return document.createTextNode(p+"{"+A+"}");function N(T){var C=T.getPropertyValue("content");return T.cssText+" content: "+C+";"}function $(T){return a.asArray(T).map(C).join("; ")+";";function C(j){return j+": "+T.getPropertyValue(j)+(T.getPropertyPriority(j)?" !important":"")}}}}}function g(){i instanceof HTMLTextAreaElement&&(u.innerHTML=i.value),i instanceof HTMLInputElement&&u.setAttribute("value",i.value)}function B(){u instanceof SVGElement&&(u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u instanceof SVGRectElement&&["width","height"].forEach(function(w){var d=u.getAttribute(w);d&&u.style.setProperty(w,d)}))}}}function Z(n){return v.resolveAll().then(function(t){var r=document.createElement("style");return n.appendChild(r),r.appendChild(document.createTextNode(t)),n})}function ee(n){return I.inlineAll(n).then(function(){return n})}function te(n,t,r){return Promise.resolve(n).then(function(o){return o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(o)}).then(a.escapeXhtml).then(function(o){return'<foreignObject x="0" y="0" width="100%" height="100%">'+o+"</foreignObject>"}).then(function(o){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+o+"</svg>"}).then(function(o){return"data:image/svg+xml;charset=utf-8,"+o})}function ne(){return{escape:B,parseExtension:t,mimeType:r,dataAsUrl:g,isDataUrl:o,canvasToBlob:l,resolveUrl:i,getAndEncode:S,uid:u(),delay:w,asArray:d,escapeXhtml:P,makeImage:y,width:U,height:b};function n(){var e="application/font-woff",c="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:c,jpeg:c,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var c=/\.([^\.\/]*?)$/g.exec(e);return c?c[1]:""}function r(e){var c=t(e).toLowerCase();return n()[c]||""}function o(e){return e.search(/^(data:)/)!==-1}function s(e){return new Promise(function(c){for(var h=window.atob(e.toDataURL().split(",")[1]),f=h.length,p=new Uint8Array(f),A=0;A<f;A++)p[A]=h.charCodeAt(A);c(new Blob([p],{type:"image/png"}))})}function l(e){return e.toBlob?new Promise(function(c){e.toBlob(c)}):s(e)}function i(e,c){var h=document.implementation.createHTMLDocument(),f=h.createElement("base");h.head.appendChild(f);var p=h.createElement("a");return h.body.appendChild(p),f.href=c,p.href=e,p.href}function u(){var e=0;return function(){return"u"+c()+e++;function c(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function y(e){return new Promise(function(c,h){var f=new Image;f.onload=function(){c(f)},f.onerror=h,f.src=e})}function S(e){var c=3e4;return m.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime()),new Promise(function(h){var f=new XMLHttpRequest;f.onreadystatechange=N,f.ontimeout=$,f.responseType="blob",f.timeout=c,f.open("GET",e,!0),f.send();var p;if(m.impl.options.imagePlaceholder){var A=m.impl.options.imagePlaceholder.split(/,/);A&&A[1]&&(p=A[1])}function N(){if(f.readyState===4){if(f.status!==200){p?h(p):T("cannot fetch resource: "+e+", status: "+f.status);return}var C=new FileReader;C.onloadend=function(){var j=C.result.split(/,/)[1];h(j)},C.readAsDataURL(f.response)}}function $(){p?h(p):T("timeout of "+c+"ms occured while fetching resource: "+e)}function T(C){console.error(C),h("")}})}function g(e,c){return"data:"+c+";base64,"+e}function B(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function w(e){return function(c){return new Promise(function(h){setTimeout(function(){h(c)},e)})}}function d(e){for(var c=[],h=e.length,f=0;f<h;f++)c.push(e[f]);return c}function P(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}function U(e){var c=x(e,"border-left-width"),h=x(e,"border-right-width");return e.scrollWidth+c+h}function b(e){var c=x(e,"border-top-width"),h=x(e,"border-bottom-width");return e.scrollHeight+c+h}function x(e,c){var h=window.getComputedStyle(e).getPropertyValue(c);return parseFloat(h.replace("px",""))}}function re(){var n=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:s,shouldProcess:t,impl:{readUrls:r,inline:o}};function t(l){return l.search(n)!==-1}function r(l){for(var i=[],u;(u=n.exec(l))!==null;)i.push(u[1]);return i.filter(function(y){return!a.isDataUrl(y)})}function o(l,i,u,y){return Promise.resolve(i).then(function(g){return u?a.resolveUrl(g,u):g}).then(y||a.getAndEncode).then(function(g){return a.dataAsUrl(g,a.mimeType(i))}).then(function(g){return l.replace(S(i),"$1"+g+"$3")});function S(g){return new RegExp(`(url\\(['"]?)(`+a.escape(g)+`)(['"]?\\))`,"g")}}function s(l,i,u){if(y())return Promise.resolve(l);return Promise.resolve(l).then(r).then(function(S){var g=Promise.resolve(l);return S.forEach(function(B){g=g.then(function(w){return o(w,B,i,u)})}),g});function y(){return!t(l)}}}function ie(){return{resolveAll:n,impl:{readAll:t}};function n(){return t(document).then(function(r){return Promise.all(r.map(function(o){return o.resolve()}))}).then(function(r){return r.join(`
`)})}function t(){return Promise.resolve(a.asArray(document.styleSheets)).then(o).then(r).then(function(l){return l.map(s)});function r(l){return l.filter(function(i){return i.type===CSSRule.FONT_FACE_RULE}).filter(function(i){return F.shouldProcess(i.style.getPropertyValue("src"))})}function o(l){var i=[];return l.forEach(function(u){try{a.asArray(u.cssRules||[]).forEach(i.push.bind(i))}catch(y){console.log("Error while reading CSS rules from "+u.href,y.toString())}}),i}function s(l){return{resolve:function(){var u=(l.parentStyleSheet||{}).href;return F.inlineAll(l.cssText,u)},src:function(){return l.style.getPropertyValue("src")}}}}}function oe(){return{inlineAll:t,impl:{newImage:n}};function n(r){return{inline:o};function o(s){return a.isDataUrl(r.src)?Promise.resolve():Promise.resolve(r.src).then(s||a.getAndEncode).then(function(l){return a.dataAsUrl(l,a.mimeType(r.src))}).then(function(l){return new Promise(function(i,u){r.onload=i,r.onerror=u,r.src=l})})}}function t(r){if(!(r instanceof Element))return Promise.resolve(r);return o(r).then(function(){return r instanceof HTMLImageElement?n(r).inline():Promise.all(a.asArray(r.childNodes).map(function(s){return t(s)}))});function o(s){var l=s.style.getPropertyValue("background");return l?F.inlineAll(l).then(function(i){s.style.setProperty("background",i,s.style.getPropertyPriority("background"))}).then(function(){return s}):Promise.resolve(s)}}}})(K)});var Y=ue(Q());var me=(()=>{let a=class a{constructor(){this.localStorageService=z(J),this._isSharingEnabled=!1}get isSharingEnabled(){return this._isSharingEnabled}initializeSharing(){let v=this.localStorageService.getItem(O.Sharing);return v===null?(this._isSharingEnabled=!1,this.localStorageService.setItem(O.Sharing,this._isSharingEnabled)):this._isSharingEnabled=v,!!v}toggleSharing(v){this._isSharingEnabled=v,this.localStorageService.setItem(O.Sharing,v)}shareElement(v,I,L="LearnMe"){return _(this,null,function*(){try{let m=document.getElementById(v);if(!m){console.error("Element not found:",v);return}let H=m.getBoundingClientRect();if(m.offsetWidth===0||m.offsetHeight===0){console.error("Element has no dimensions");return}yield new Promise(D=>setTimeout(D,500));let V=yield Y.default.toPng(m,{quality:1,cacheBust:!0,width:m.scrollWidth,height:m.scrollHeight}),R=yield(yield fetch(V)).blob();if(!R||R.size===0){console.error("Failed to create blob");return}let M=new File([R],`${L}.png`,{type:"image/png",lastModified:Date.now()});if(navigator.share&&navigator.canShare({files:[M]}))yield navigator.share({files:[M],title:`${L}.png`,text:I});else{let D=URL.createObjectURL(R),E=document.createElement("a");E.href=D,E.download=`${L}.png`,document.body.appendChild(E),E.click(),document.body.removeChild(E),setTimeout(()=>URL.revokeObjectURL(D),100)}}catch(m){console.error("Error sharing:",m)}})}};a.\u0275fac=function(I){return new(I||a)},a.\u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"});let k=a;return k})();export{me as a};
